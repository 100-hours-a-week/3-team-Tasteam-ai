hits = query_qdrant_hybrid(client,"든든한 한 끼")

for hit in hits:
    print(hit.payload["content"], "score:", hit.score)

결과

비주얼부터 심쿵    보는 그대로의 감동이 입에도 전해져요 훕 score: 0.5
앙버터가 세젤맛입니당 score: 0.33333334
11시 오픈이래서 11시 5분에 가니 벌써 만석. 세 명이서 꼬막 비빔밥 하나에 밥 한 공기 추가해 배부르게 먹었다. 먹다 보니 양이 많아서 밥 하나는 안 시켜도 될뻔했다. 밥이 비벼 친 채로 반  꼬막만 반 나오는데 밥을 비빈 부분이 안 비빈 부분보다 확실히 싱겁다. 짜게 먹을 사람들은 밥에 꼬막을 더 얹어 먹으면 된다. 재료에 참기름만 있는 건 아닌 것 같고 아무래도 들기름도 같이 넣은 듯. 꼬막에 윤기가 좌르르 흐른다. 꼬막이 통통하고 살이 잘 차올라서 쫄깃쫄깃 씹는 맛이 있다. 게다가 파와 고추가 튼실하고 양이 많아서 비주얼 적으로도, 맛으로도 만족스러웠다. 양념이 되어있고 밥이랑 같이 비벼 먹다 보니 마지막에 좀 더부룩하긴 하였지만 강릉 와서 한 번쯤 가보면 좋을 곳. score: 0.25
임진각 가족여행 왔다가 들렸어요 전방에 있는 부대찌개집이어서 그런지 전통적인 맛이 나네요 score: 0.2
정말 최악으로 맛없음.. 물에 면탄 맛.. score: 0.16666667

이유

RRF

하이브리드(예: dense + bm25) 결과들을 합쳤을 때 몇 등인가

해결 방안

Fusion(RRF) 말고, **dense 단독 / bm25 단독**으로 각각 `query_points` 해서,
각각에서의 score(유사도/매칭)가 어떤지 먼저 확인

* dense 단독 점수는 보통 cosine/inner-product 기반 “연속값”
* bm25 단독 점수는 sparse 매칭 기반 값

둘 다 약하면 “든든”이 검색어로 너무 짧거나, 모델이 한국어 의미를 잘 못 잡는 상태일 확률이 큽니다.

2. RRF의 `k` 값(또는 상수)이 너무 작을 가능성

네 점수 형태가 **정확히 1/(rank+1)** 이라서, RRF의 상수가 사실상 **0 또는 1 수준**처럼 보입니다.
만약 Qdrant의 RRF 구현에서 k(상수)를 조절할 수 있다면(버전/SDK에 따라 다름), 크게 잡으면 점수가 더 촘촘해지긴 하지만…

중요한 건: **어차피 RRF 점수는 “유사도”가 아니라 “순위”**라서, 점수로 품질 판단하면 계속 헷갈립니다.

### 품질 올리기

### A) 쿼리를 늘려라: 동의어/확장

“든든”은 의미가 넓고 짧아서 약합니다. 아래처럼 확장하면 하이브리드가 훨씬 잘 잡아요.

* “든든한 한 끼”
* “푸짐하다”
* “양이 많다”
* “배부르다”
* “가성비 좋다”

=> 실서비스에선 **쿼리 리라이트(동의어 확장)** 하나만 해도 체감 확 좋아져요.

### B) 한국어 임베딩 모델 점검

만약 dense 쪽이 영어/멀티 모델이거나 한국어 성능이 약하면 “든든=푸짐” 같은 뉘앙스가 잘 안 잡힐 수 있어요.
(특히 리뷰가 구어체/짧은 문장/이모지 섞이면 더)

### C) 2단계 검색(리랭킹) 넣기

하이브리드로 “후보 top-k”만 뽑고,
그 다음에

* cross-encoder rerank
* 또는 LLM rerank(비용은 더 들지만)

이렇게 하면 “최악으로 맛없음” 같은 노이즈가 확 줄어요.

### D) 문서 단위를 너무 길게 넣으면 의미가 퍼짐

지금 3번째 리뷰처럼 아주 긴 문서가 섞여 있죠.
긴 문서 하나에 “든든” 관련 문장이 일부만 있어도 전체가 같이 끌려올 수 있어요.

=> 리뷰를 **문장/절 단위로 쪼개서** 넣으면 “든든(푸짐/배부름)” 관련 구간만 더 잘 떠요.

---

"든든" 에 맞는건 

세번째인 "11시 오픈이래서 11시 5분에 가니 벌써 만석. 세 명이서 꼬막 비빔밥 하나에 밥 한 공기 추가해 배부르게 먹었다. 먹다 보니 양이 많아서 밥 하나는 안 시켜도 될뻔했다. 밥이 비벼 친 채로 반  꼬막만 반 나오는데 밥을 비빈 부분이 안 비빈 부분보다 확실히 싱겁다. 짜게 먹을 사람들은 밥에 꼬막을 더 얹어 먹으면 된다. 재료에 참기름만 있는 건 아닌 것 같고 아무래도 들기름도 같이 넣은 듯. 꼬막에 윤기가 좌르르 흐른다. 꼬막이 통통하고 살이 잘 차올라서 쫄깃쫄깃 씹는 맛이 있다. 게다가 파와 고추가 튼실하고 양이 많아서 비주얼 적으로도, 맛으로도 만족스러웠다. 양념이 되어있고 밥이랑 같이 비벼 먹다 보니 마지막에 좀 더부룩하긴 하였지만 강릉 와서 한 번쯤 가보면 좋을 곳."



hits = query_qdrant_hybrid(client,"든든한 한 끼")

for hit in hits:
    print(hit.payload["content"], "score:", hit.score)

결과

"든든한 한 끼"에 맞는 문장이 제일 위로 올라옴. --> 잘 나왔다는 증거.

11시 오픈이래서 11시 5분에 가니 벌써 만석. 세 명이서 꼬막 비빔밥 하나에 밥 한 공기 추가해 배부르게 먹었다. 먹다 보니 양이 많아서 밥 하나는 안 시켜도 될뻔했다. 밥이 비벼 친 채로 반  꼬막만 반 나오는데 밥을 비빈 부분이 안 비빈 부분보다 확실히 싱겁다. 짜게 먹을 사람들은 밥에 꼬막을 더 얹어 먹으면 된다. 재료에 참기름만 있는 건 아닌 것 같고 아무래도 들기름도 같이 넣은 듯. 꼬막에 윤기가 좌르르 흐른다. 꼬막이 통통하고 살이 잘 차올라서 쫄깃쫄깃 씹는 맛이 있다. 게다가 파와 고추가 튼실하고 양이 많아서 비주얼 적으로도, 맛으로도 만족스러웠다. 양념이 되어있고 밥이랑 같이 비벼 먹다 보니 마지막에 좀 더부룩하긴 하였지만 강릉 와서 한 번쯤 가보면 좋을 곳. score: 0.75
비주얼부터 심쿵    보는 그대로의 감동이 입에도 전해져요 훕 score: 0.5
신규 개업했을 때 궁금해서 가봤어요 오며 가며 이 골목 많이 지나다니는데 새로 개업한 곳임에도 줄이 엄청 길더군요 평일 저녁 한 시간 안되게 웨이팅 해서 들어갔어요,, 정가를 비랑 이동갈비 먹었고, 육회비빔밥도 맛봤는데 다 무난하게 맛있더라고요! 양념도 지나치게 달거나 짜지 않고 적당해요  무엇보다 소갈비치고, 그것도 강남권에서 이 가격이면 저렴한 편이니까 기분 좋게 방문할 만한 곳이라는 주관적인 판단,, 개인적으로는 길게 웨이팅을 해가면서 찾아와 먹을 정도까지는 아니어도 근처 사시는 분들이나, 웨이팅 없을 때 소갈비생각 나시면 들러볼 만한 곳입니다 score: 0.33333334
앙버터가 세젤맛입니당 score: 0.33333334
아이들이 재밌게 놀 수도 있어요 score: 0.2

1) 점수 0.75가 나온 이유 (RRF 맞음) --> 1번 문장

아까는 0.5, 0.333, 0.25...처럼 1/(rank+1) 패턴이었는데, 이번엔 0.75가 튀었죠.

이건 RRF가 보통 이렇게 합쳐지기 때문이에요:

어떤 문서가 dense 랭킹에서도 상위

동시에 bm25 랭킹에서도 상위

그러면 RRF 점수는 **(1/(k+rank_dense)) + (1/(k+rank_bm25))**처럼 합산돼요(구현에 따라 상수 k가 0 또는 작은 값처럼 보이는 상황).

지금 1등 문서(꼬막 비빔밥 후기)가 “배부르게 먹었다 / 양이 많다”가 들어가 있어서

dense(의미 매칭)에서도 잘 걸리고

sparse(bm25, 키워드)에서도 “한 끼/배부르게/양” 같은 단어로 같이 올라와서
두 리스트에서 점수가 합쳐져 0.75가 된 거예요.

반대로 “앙버터…”는 의미/키워드 둘 다에서 강하지 않아서 한쪽에서만 걸려 0.333 정도로 남아 있는 느낌이고요.

