네 흐름이 거의 정답이고, **“오프라인에서 분포를 학습(발견) → 온라인에서 검색/요약”**이 가장 안정적인 구조예요.
다만 한 가지를 분리해서 생각하면 더 깔끔해져요:

* **오프라인:** “aspect 스키마(카테고리) + 표현 사전(말하는 방식)”을 만든다
* **온라인:** 새 데이터셋(실서비스)에서 **그 스키마로** 근거를 “찾고(검색)” 요약한다

아래처럼요.

---

## 1) 오프라인에서 가져와야 하는 것 (대량 데이터셋)

### A. Aspect 목록(스키마)

예: `맛/양/가격/서비스/위생/대기/분위기/접근성…`

이건 **빈도+클러스터링**으로 “발견”하는 게 맞고, 한 번 만들어두면 재사용 가능.

### B. Aspect별 표현 사전(lexicon / patterns)

“맛”을 사람들이 어떻게 말하는지:

* “맛있다/존맛/간이 세다/싱겁다/감칠맛/불향/비린내…”
* “너무 달다/짜다/맵다”
* “식감이 쫄깃/질김”

이건

* n-gram/키프레이즈 빈도
* 동의어 병합(임베딩 클러스터)
* (선택) LLM로 cluster 라벨링
  같은 방식으로 만들 수 있어요.

👉 여기까지가 “대량 데이터셋에서 지식 추출” 파트.

---

## 2) 그다음 실서비스(새 데이터셋)에서 해야 하는 것

여기서 중요한 포인트:

> 실서비스 데이터셋에 대해 **dense/sparse 검색은 “aspect를 찾기 위해”가 아니라**
> **각 aspect에 대한 “근거 리뷰를 모으기 위해”** 쓰는 게 가장 안정적이에요.

### 온라인 단계 흐름

1. 새로 들어온 리뷰들을 dense + sparse로 임베딩해서 Qdrant에 적재
2. 각 aspect에 대해 “질의(=aspect 쿼리)”를 만들어 검색

   * sparse: lexicon 중심 (“간이 세다”, “싱겁다”, “감칠맛”…)
   * dense: 의미적으로 가까운 표현까지 회수
3. top-k 근거 리뷰를 모아서
4. support_count / 다양성(중복 제거) / 신뢰도 체크 후
5. 요약 생성

---

## 3) 왜 “오프라인 지식 + 온라인 검색”이 좋은가

### ✅ 장점 1: 재현성 & 안정성

* aspect가 LLM 샘플링에 흔들리지 않음
* 매번 비슷한 구조로 결과가 나옴

### ✅ 장점 2: 도메인/업장별 편차 흡수

* “맛” 표현은 업장/카테고리마다 달라요(카페/치킨/회/중식…)
* sparse lexicon은 카테고리별로 튜닝 가능
* dense는 표현 다양성을 커버

### ✅ 장점 3: hallucination 방어

* “맛이 좋다” 주장 → 실제 근거 리뷰 top-k가 있어야만 요약에 반영

---

## 4) 여기서 흔한 함정 2개

### 함정 A: 오프라인에서 만든 aspect/사전을 “고정”해버리기

실서비스에는 새로운 표현이 계속 생겨요.

그래서 정답은:

* **기본 스키마는 고정**
* **사전은 계속 업데이트(주기적 재학습)**

### 함정 B: online에서 “검색만” 하고 품질 검증을 안 하기

검색은 근거를 “모아줄 뿐”이고,

* 중복(비슷한 리뷰만 잔뜩)
* 편향(한 명이 반복 작성)
* 스팸
  이 섞일 수 있어요.

그래서 너가 말하던 **support_count / consistency / diversity**가 같이 들어가야 함.

---

## 5) 추천 아키텍처 한 줄 요약

* **오프라인:** aspect discovery + lexicon 구축(대량 데이터)
* **온라인:** 새 리뷰 적재 → aspect별 hybrid 검색 → 근거셋 구성 → 요약 생성
* **주기적:** lexicon 업데이트(신규 표현 흡수)

---

네가 지금 “대표벡터 top-k + hybrid + 검증”을 만들고 있잖아요.
거기에 **오프라인 aspect/lexicon 레이어를 얹으면** 진짜로 서비스가 안정해져요.

원하면, 네 도메인(음식/식당) 기준으로:

* aspect 스키마 예시(카테고리별)
* “맛” lexicon 자동 구축 방법(빈도→클러스터→정제)
* online에서 aspect 질의 생성 템플릿(예: sparse query 문장 설계)

이렇게 바로 설계안 형태로 적어줄게요.
