1. 피크시간/비피크시간 

처음엔 각 음식점에 대한 트래픽에 대한 데이터가 없으니까 일단은 일괄로 모든 음식점의 피크 시간에 자주 배치처리, 비피크시간에도 피크 시간과 동일한 기준을 적용시키면, 잦은 업데이트를 방지 가능하다고 판단.

ex) 초기 설정, 모든 음식점 10분에 한번씩 업데이트

2. 트래픽 데이터가 쌓였음 

트래픽 데이터가 쌓여서 이제 각 음식점의 트래픽마다 업데이트 주기의 세부적인 설정이 가능해짐. 예를들어 인기음식점이라 피크 시간에 리뷰 트래픽이 40~50개 정도인 군(40~50), 상대적으로 인기 음식점에 비해서 피크시간임에도 리뷰 트래픽이 30~40명 정도인 군(30~40), ... ,(20~30), (10~20), (0~10) 이렇게 군을 나눌거 같은데,

ex) 군 별로, 40~50 tier 10분에 한번씩, 0~10 tier 60분에 한번씩

이 전략이 좋은 점:

① 연속값을 이산화(discretization)한 점 👍

완전 연속 제어(수식 기반)는:

튜닝 난이도 ↑

디버깅 난이도 ↑

운영 리스크 ↑

군 단위 정책은:

설명 가능성 ↑

롤백 쉬움

SRE/백엔드와 커뮤니케이션 쉬움

② “음식점 단위”로 보는 게 맞다 👍

리뷰 트래픽은 전형적인 long-tail 분포

상위 10~20%가 대부분의 트래픽을 만든다

전 음식점 동일 주기 = 자원 낭비

③ GPU/LLM 배치 처리와 궁합이 좋다 👍

네 구조(비동기 큐 + 배치 + watchdog + vLLM)에서는

요청 밀도 기반 스케줄링이 가장 비용 효율적

개선 방안:

✅ 1단계 고도화: 개수 × 변화량
update_score = review_count × novelty_ratio


novelty_ratio 예:

새로운 aspect 등장 비율

기존 요약/강점과의 embedding distance

감성 분포 변화량 (KL divergence 등)

👉 이렇게 하면:

리뷰 수 적어도 의미 변화가 크면 빠른 업데이트

리뷰 많아도 의미 변화 없으면 스킵

✅ 2단계: 군은 유지하되 내부적으로 soft rule

예:

(30~40) 군이지만

변화량 높으면 → 상위 군처럼 처리

변화량 낮으면 → 하위 군처럼 처리

👉 정책 설명 가능성은 유지, 효율만 개선

✅ 3단계 (최종): SLA 기반 역설계

예:

“요약이 실제 리뷰 상태와 평균 1시간 이상 어긋나지 않게”

그 SLA를 만족하도록 음식점별 최소 업데이트 빈도 계산

---

중복 실행 방지

중복 실행 방지, 중복 저장 방지 전략

✅ 중복 실행 방지(비용 중복 방지) **[구현 완료]**

Redis 락 (예: SET lock:{restaurant_id}:{analysis_type} NX EX <ttl>)

이걸 "엔드포인트 진입 시" 걸어야 함

이게 있어야 **중복 실행을 '차단'**함.

**구현 상태:**
- ✅ `RedisLock` 클래스 구현 (`src/cache.py`)
- ✅ `acquire_lock()` Context Manager 구현
- ✅ API 라우터에 락 적용:
  - `/api/v1/sentiment/analyze` - 감성 분석
  - `/api/v1/llm/summarize` - 리뷰 요약
  - `/api/v1/llm/extract/strengths` - 강점 추출
- ✅ 락 획득 실패 시 HTTP 409 (Conflict) 반환
- ✅ Redis 미연결 시 락 없이 진행 (개발 환경 지원)

---

캐싱 전략

현재 상황

요약
항목	상태
CacheManager 구현	구현됨
Redis 연동 코드	구현됨
API 라우터에서 캐시 사용	사용 안 함
LLM 응답 캐싱	없음
임베딩 벡터 캐싱	없음

결론: 캐시 인프라는 구현되어 있으나 실제 적용은 되어 있지 않습니다. Redis가 설정되어 있어도 API에서 캐시를 조회/저장하는 로직이 없어 현재는 동작하지 않습니다.

개선 계획

먼저 baseline(캐시 없음)에서
p50/p95 latency
GPU 사용률/요청당 비용(토큰/초)
처리
중복 호출 비율
을 로그로 확보

그 다음 캐시를 붙이고 전/후 비교를 보여주기

설명 사항:

“캐시가 언제 유효하고, 어떤 부작용이 있고, 얼마큼 개선됐는지 측정했다”

---

현재는 Redis 락만 구현

캐싱이 필요할땐,

이미 락 용도로 사용한 REDIS를 이용.

---

